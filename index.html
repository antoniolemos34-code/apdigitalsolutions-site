<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AP Home & Lifestyle</title>
  <meta name="description" content="Curated pieces for modern living. Premium picks, ready to shop." />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:wght@500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f5f1e8;
      --bg2:#efe7da;
      --ink:#0f172a;
      --muted: rgba(15,23,42,.72);
      --stroke: rgba(15,23,42,.14);
      --glass: rgba(255,255,255,.55);
      --glass2: rgba(255,255,255,.36);
      --shadow: 0 18px 60px rgba(15,23,42,.14);
      --radius: 26px;
      --max: 1180px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1200px 800px at 18% 0%, rgba(255,255,255,.62), transparent 58%),
        radial-gradient(900px 700px at 85% 16%, rgba(255,255,255,.50), transparent 55%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      overflow-x:hidden;
    }
    a{color:inherit; text-decoration:none}
    .wrap{max-width:var(--max); margin:0 auto; padding:24px}
    .glass{
      border:1px solid var(--stroke);
      background: var(--glass2);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
    }

    /* Top bar */
    .top{
      position: sticky; top: 16px; z-index: 50;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding: 14px 18px;
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.60);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      box-shadow: 0 12px 36px rgba(15,23,42,.10);
    }
    .brand{display:flex; align-items:center; gap:12px; min-width: 260px;}
    .logo{
      width:40px; height:40px; border-radius:14px;
      display:grid; place-items:center;
      background: rgba(255,255,255,.60);
      border:1px solid var(--stroke);
      overflow:hidden;
    }
    .logo img{width:100%; height:100%; object-fit:contain; padding:6px; display:block;}
    .brand strong{font-weight:600; letter-spacing:.2px}
    .sub{font-size:13px; color:rgba(15,23,42,.62)}
    .nav{display:flex; gap:12px; align-items:center; color: var(--muted); font-size:14px;}
    .nav a{padding:10px 12px; border-radius:999px; border:1px solid transparent;}
    .nav a:hover{border-color: var(--stroke); background: rgba(255,255,255,.35);}
    .cta{display:flex; gap:10px; align-items:center; justify-content:flex-end; min-width: 260px;}

    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      height:42px; padding:0 16px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.66);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      font-weight:600;
      font-size:14px;
      box-shadow: 0 10px 26px rgba(15,23,42,.10);
      transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
      white-space:nowrap;
      cursor:pointer;
    }
    .btn:hover{transform: translateY(-1px); box-shadow: 0 16px 34px rgba(15,23,42,.12);}
    .btn.primary{
      background: rgba(15,23,42,.94);
      color:#fff;
      border-color: rgba(15,23,42,.35);
    }
    .btn.primary:hover{background: rgba(15,23,42,.98);}
    .btn.ghost{background: rgba(255,255,255,.42);}

    /* Hero */
    .hero{margin-top: 18px; overflow:hidden; position:relative;}
    .hero-inner{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap: 18px;
      padding: 18px;
    }
    .hero-left{
      padding: 28px 22px;
      border-radius: 22px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.60);
      box-shadow: 0 18px 46px rgba(15,23,42,.10);
      position:relative;
      overflow:hidden;
    }
    .badge{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 14px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.66);
      color: rgba(15,23,42,.76);
      font-size: 13px;
    }
    .dot{width:10px; height:10px; border-radius:999px; background: rgba(15,23,42,.88); box-shadow: 0 0 0 6px rgba(15,23,42,.08);}
    h1{
      margin: 16px 0 10px;
      font-family: "Playfair Display", serif;
      font-weight: 600;
      font-size: clamp(44px, 4.6vw, 70px);
      line-height: 1.02;
      letter-spacing: -0.8px;
    }
    .tag{
      margin: 0 0 18px;
      color: var(--muted);
      font-size: 18px;
      line-height: 1.65;
      max-width: 60ch;
    }
    .hero-actions{display:flex; gap:12px; flex-wrap:wrap; margin-top: 6px;}
    .mini{margin-top: 14px; display:flex; flex-wrap:wrap; gap:10px; color: rgba(15,23,42,.65); font-size: 13px;}
    .chip{padding:10px 12px; border-radius: 999px; border:1px solid var(--stroke); background: rgba(255,255,255,.58);}

    /* Collage */
    .collage{
      border-radius: 22px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.36);
      overflow:hidden;
      display:grid;
      grid-template-columns: 1fr 1fr;
      grid-auto-rows: 220px;
      gap: 10px;
      padding: 10px;
      box-shadow: 0 18px 46px rgba(15,23,42,.10);
    }
    .tile{
      border-radius: 18px;
      overflow:hidden;
      position:relative;
      border:1px solid rgba(15,23,42,.10);
      background:#fff;
    }
    .tile img{width:100%; height:100%; object-fit:cover; display:block; transform: scale(1.02);}
    .tile::after{content:""; position:absolute; inset:0; background: linear-gradient(180deg, transparent 50%, rgba(15,23,42,.18)); pointer-events:none;}
    .tile .label{position:absolute; left:12px; bottom:12px; color:#fff; font-weight:600; font-size:14px; text-shadow: 0 8px 22px rgba(0,0,0,.35);}
    .tile.big{grid-column: 1 / span 2; height: 240px;}

    /* Sections */
    section{margin-top: 18px;}
    .section-head{
      display:flex; align-items:flex-end; justify-content:space-between; gap:12px;
      padding: 18px 22px;
      border-bottom:1px solid var(--stroke);
    }
    .section-head h2{
      margin:0;
      font-size: 15px;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: rgba(15,23,42,.72);
    }
    .section-head p{margin:6px 0 0; font-size: 14px; color: rgba(15,23,42,.60);}

    .grid{
      padding: 18px;
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 14px;
    }
    .card{
      grid-column: span 4;
      border:1px solid var(--stroke);
      border-radius: 22px;
      background: rgba(255,255,255,.62);
      box-shadow: 0 16px 42px rgba(15,23,42,.10);
      overflow:hidden;
      position:relative;
    }
    .card img{width:100%; height: 220px; object-fit:cover; display:block;}
    .card .body{padding: 14px 14px 16px;}
    .card .title{font-weight:700; letter-spacing:.2px; margin:0 0 6px;}
    .card .desc{margin:0; color: rgba(15,23,42,.70); font-size: 14px; line-height:1.5;}
    .link{margin-top: 10px; display:inline-flex; gap:8px; align-items:center; font-weight:600; font-size:14px; opacity:.9;}
    .link:hover{opacity:1}

    /* Featured products (Shopify) */
    .products{
      padding: 18px;
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 14px;
    }
    .p-card{
      grid-column: span 4;
      border:1px solid var(--stroke);
      border-radius: 22px;
      background: rgba(255,255,255,.62);
      box-shadow: 0 16px 42px rgba(15,23,42,.10);
      overflow:hidden;
      position:relative;
      display:flex;
      flex-direction:column;
      min-height: 420px;
    }
    .p-img{width:100%; height: 240px; object-fit:cover; display:block; background:#fff;}
    .p-body{padding: 14px 14px 16px; display:flex; flex-direction:column; gap:10px; flex:1;}
    .p-title{margin:0; font-weight:700; letter-spacing:.2px; line-height:1.25;}
    .p-price{color: rgba(15,23,42,.75); font-weight:600;}
    .p-actions{display:flex; gap:10px; margin-top:auto; flex-wrap:wrap;}
    .tiny{font-size:12px; color: rgba(15,23,42,.55); margin-top: 8px;}

    /* Cart */
    .cart-btn{position:relative}
    .badge-count{
      position:absolute; top:-6px; right:-6px;
      min-width:18px; height:18px;
      padding:0 6px;
      border-radius:999px;
      background: rgba(15,23,42,.94);
      color:#fff;
      display:grid; place-items:center;
      font-size:12px;
      border:2px solid rgba(255,255,255,.8);
    }
    .drawer{
      position:fixed; inset:0;
      background: rgba(15,23,42,.30);
      display:none;
      z-index: 200;
    }
    .drawer.open{display:block}
    .panel{
      position:absolute; top:0; right:0; height:100%; width:min(420px, 92vw);
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      border-left: 1px solid var(--stroke);
      padding: 18px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .panel h3{margin:6px 0 4px; font-size:16px; letter-spacing:.18em; text-transform:uppercase; color: rgba(15,23,42,.72);}
    .items{display:flex; flex-direction:column; gap:10px; overflow:auto; padding-right:6px;}
    .item{
      border:1px solid var(--stroke);
      border-radius: 18px;
      background: rgba(255,255,255,.70);
      display:grid;
      grid-template-columns: 66px 1fr;
      gap:12px;
      padding: 10px;
      align-items:center;
    }
    .item img{width:66px; height:66px; border-radius:14px; object-fit:cover; border:1px solid rgba(15,23,42,.10); background:#fff;}
    .item .name{font-weight:700; font-size:14px; margin:0 0 4px;}
    .item .meta{font-size:13px; color: rgba(15,23,42,.70);}
    .panel .row{display:flex; justify-content:space-between; align-items:center; gap:10px;}
    .close{margin-left:auto}
    footer{padding: 28px 8px 46px; color: rgba(15,23,42,.55); font-size: 13px; text-align:center;}

    @media (max-width: 980px){
      .nav{display:none}
      .hero-inner{grid-template-columns: 1fr; padding: 14px}
      .card{grid-column: span 12}
      .p-card{grid-column: span 12}
      .brand,.cta{min-width:auto}
    }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- TOP -->
    <header class="top">
      <div class="brand">
        <div class="logo">
          <!-- Opcional: coloca este ficheiro no GitHub em /assets/ -->
          <img src="assets/ap-home-lifestyle-logo.png" alt="AP Home & Lifestyle" onerror="this.style.display='none'">
        </div>
        <div>
          <strong>AP Home & Lifestyle</strong><br>
          <span class="sub">Curated pieces for modern living</span>
        </div>
      </div>

      <nav class="nav">
        <a href="#collections">Collections</a>
        <a href="#featured">Featured</a>
        <a href="#shop">Shop</a>
        <a href="https://srd8ja-i0.myshopify.com/" target="_blank" rel="noopener">Open Full Store</a>
      </nav>

      <div class="cta">
        <button class="btn ghost cart-btn" id="openCart" type="button">
          Cart <span class="badge-count" id="cartCount" style="display:none">0</span>
        </button>
        <a class="btn" href="https://srd8ja-i0.myshopify.com/" target="_blank" rel="noopener">Browse</a>
        <a class="btn primary" href="#featured">Shop Now</a>
      </div>
    </header>

    <!-- HERO -->
    <main class="hero glass">
      <div class="hero-inner">
        <div class="hero-left">
          <div class="badge"><span class="dot"></span> Premium picks • Modern living • Ready to ship</div>
          <h1>Home essentials,<br>elevated.</h1>
          <p class="tag">
            A curated selection of smart, stylish pieces for everyday comfort — clean design, premium feel, ready to shop.
          </p>
          <div class="hero-actions">
            <a class="btn primary" href="#featured">Shop featured</a>
            <a class="btn" href="https://srd8ja-i0.myshopify.com/collections/all" target="_blank" rel="noopener">Open full store</a>
          </div>
          <div class="mini">
            <span class="chip">Minimal aesthetic</span>
            <span class="chip">Gift-ready finds</span>
            <span class="chip">Trending essentials</span>
          </div>
        </div>

        <!-- Image collage -->
        <div class="collage" aria-label="Lifestyle imagery">
          <div class="tile big">
            <img alt="Modern home interior"
              src="https://images.unsplash.com/photo-1505693416388-ac5ce068fe85?auto=format&fit=crop&w=1400&q=80" />
            <div class="label">Modern interiors</div>
          </div>
          <div class="tile">
            <img alt="Desk essentials"
              src="https://images.unsplash.com/photo-1524758631624-e2822e304c36?auto=format&fit=crop&w=900&q=80" />
            <div class="label">Desk</div>
          </div>
          <div class="tile">
            <img alt="Kitchen accessories"
              src="https://images.unsplash.com/photo-1496412705862-e0088f16f791?auto=format&fit=crop&w=900&q=80" />
            <div class="label">Kitchen</div>
          </div>
        </div>
      </div>
    </main>

    <!-- COLLECTIONS -->
    <section id="collections" class="glass">
      <div class="section-head">
        <div>
          <h2>Collections</h2>
          <p>Browse by vibe — clean, useful, and premium-looking.</p>
        </div>
        <a class="btn" href="https://srd8ja-i0.myshopify.com/collections/all" target="_blank" rel="noopener">View all</a>
      </div>

      <div class="grid">
        <article class="card">
          <img alt="Smart gadgets"
            src="https://images.unsplash.com/photo-1518444028785-8f5a4b1a95b6?auto=format&fit=crop&w=1200&q=80">
          <div class="body">
            <p class="title">Smart Essentials</p>
            <p class="desc">Everyday tech that makes life simpler — clean look, practical use.</p>
            <a class="link" href="#featured">Shop featured →</a>
          </div>
        </article>

        <article class="card">
          <img alt="Home decor"
            src="https://images.unsplash.com/photo-1523755231516-e43fd2e8dca5?auto=format&fit=crop&w=1200&q=80">
          <div class="body">
            <p class="title">Home & Decor</p>
            <p class="desc">Neutral tones, modern shapes — pieces that elevate your space.</p>
            <a class="link" href="https://srd8ja-i0.myshopify.com/collections/all" target="_blank" rel="noopener">Open store →</a>
          </div>
        </article>

        <article class="card">
          <img alt="Lifestyle accessories"
            src="https://images.unsplash.com/photo-1512436991641-6745cdb1723f?auto=format&fit=crop&w=1200&q=80">
          <div class="body">
            <p class="title">Lifestyle Picks</p>
            <p class="desc">Small upgrades that feel premium — perfect for gifting.</p>
            <a class="link" href="https://srd8ja-i0.myshopify.com/collections/all" target="_blank" rel="noopener">Browse picks →</a>
          </div>
        </article>
      </div>
    </section>

    <!-- FEATURED PRODUCTS (loads from Shopify) -->
    <section id="featured" class="glass">
      <div class="section-head">
        <div>
          <h2>Featured</h2>
          <p>Real products from Shopify — add to cart and checkout.</p>
        </div>
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <a class="btn" href="https://srd8ja-i0.myshopify.com/collections/all" target="_blank" rel="noopener">Open Full Store</a>
          <button class="btn primary" id="checkoutBtnTop" type="button">Checkout</button>
        </div>
      </div>

      <div class="products" id="productsGrid">
        <!-- Products will render here -->
      </div>

      <div class="tiny" style="padding: 0 18px 18px;">
        If products don’t appear, the Storefront token is missing/invalid. Links above still work.
      </div>
    </section>

    <!-- SHOP (simple links – always works) -->
    <section id="shop" class="glass">
      <div class="section-head">
        <div>
          <h2>Shop</h2>
          <p>Fastest path: open the store and checkout on Shopify.</p>
        </div>
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <a class="btn" href="https://srd8ja-i0.myshopify.com/" target="_blank" rel="noopener">Browse</a>
          <a class="btn primary" href="https://srd8ja-i0.myshopify.com/collections/all" target="_blank" rel="noopener">Shop all</a>
        </div>
      </div>

      <div style="padding:18px; display:grid; grid-template-columns: repeat(12, 1fr); gap:14px;">
        <div class="card" style="grid-column: span 6;">
          <img alt="Gifts"
               src="https://images.unsplash.com/photo-1512909006721-3d6018887383?auto=format&fit=crop&w=1400&q=80">
          <div class="body">
            <p class="title">Gift-ready picks</p>
            <p class="desc">Curated gifts that look premium — easy win for birthdays, new homes, and upgrades.</p>
            <a class="link" href="https://srd8ja-i0.myshopify.com/collections/all" target="_blank" rel="noopener">Shop gifts →</a>
          </div>
        </div>

        <div class="card" style="grid-column: span 6;">
          <img alt="Minimal lifestyle"
               src="https://images.unsplash.com/photo-1487014679447-9f8336841d58?auto=format&fit=crop&w=1400&q=80">
          <div class="body">
            <p class="title">Minimal lifestyle</p>
            <p class="desc">Clean, modern, and useful — pieces that match your home and your routine.</p>
            <a class="link" href="#featured">Shop featured →</a>
          </div>
        </div>
      </div>
    </section>

    <footer>
      © <span id="y"></span> AP Home & Lifestyle •
      <a href="https://srd8ja-i0.myshopify.com/" target="_blank" rel="noopener" style="text-decoration:underline;">Shopify Store</a>
    </footer>
  </div>

  <!-- CART DRAWER -->
  <div class="drawer" id="drawer">
    <div class="panel">
      <div class="row">
        <h3 style="margin:0;">Cart</h3>
        <button class="btn ghost close" id="closeCart" type="button">Close</button>
      </div>

      <div class="items" id="cartItems"></div>

      <div class="row" style="margin-top:auto;">
        <div style="font-weight:700;">Total</div>
        <div style="font-weight:700;" id="cartTotal">£0.00</div>
      </div>

      <button class="btn primary" id="checkoutBtn" type="button">Checkout</button>
      <a class="btn" href="https://srd8ja-i0.myshopify.com/collections/all" target="_blank" rel="noopener">Open Full Store</a>

      <div class="tiny">Checkout happens on Shopify (secure).</div>
    </div>
  </div>

  <!-- Shopify Buy SDK -->
  <script src="https://sdks.shopifycdn.com/js-buy-sdk/v2/latest/index.umd.min.js"></script>

  <script>
    // ====== CONFIG (only change token if needed) ======
    const SHOP_DOMAIN = "srd8ja-i0.myshopify.com";
    const STOREFRONT_TOKEN = "PASTE_YOUR_STOREFRONT_TOKEN_HERE"; // <-- put your token here
    const COLLECTION_HANDLE = "all"; // matches /collections/all
    const CURRENCY_SYMBOL = "£";

    // ====== UI helpers ======
    const $ = (id) => document.getElementById(id);
    const drawer = $("drawer");
    const openCartBtn = $("openCart");
    const closeCartBtn = $("closeCart");
    const cartCount = $("cartCount");
    const cartItems = $("cartItems");
    const cartTotal = $("cartTotal");
    const checkoutBtn = $("checkoutBtn");
    const checkoutBtnTop = $("checkoutBtnTop");
    const productsGrid = $("productsGrid");

    function money(amount){
      // amount is string/number from Storefront (usually "12.34")
      const n = Number(amount || 0);
      return CURRENCY_SYMBOL + n.toFixed(2);
    }

    function openDrawer(){ drawer.classList.add("open"); }
    function closeDrawer(){ drawer.classList.remove("open"); }
    openCartBtn.addEventListener("click", openDrawer);
    closeCartBtn.addEventListener("click", closeDrawer);
    drawer.addEventListener("click", (e)=>{ if(e.target === drawer) closeDrawer(); });

    // ====== Shopify Client ======
    let client = null;
    let checkout = null;

    async function initShopify(){
      if(!STOREFRONT_TOKEN || STOREFRONT_TOKEN.includes("PASTE_")){
        productsGrid.innerHTML = `
          <div class="p-card" style="grid-column: span 12;">
            <div class="p-body">
              <h3 class="p-title">Storefront token missing</h3>
              <div class="p-price">Add your Shopify Storefront access token to enable products here.</div>
              <div class="p-actions">
                <a class="btn primary" href="https://${SHOP_DOMAIN}/collections/all" target="_blank" rel="noopener">Open Shop</a>
                <a class="btn" href="https://${SHOP_DOMAIN}/admin" target="_blank" rel="noopener">Open Shopify Admin</a>
              </div>
              <div class="tiny">This section will work as soon as the token is added.</div>
            </div>
          </div>
        `;
        return;
      }

      client = ShopifyBuy.buildClient({
        domain: SHOP_DOMAIN,
        storefrontAccessToken: STOREFRONT_TOKEN
      });

      checkout = await client.checkout.create();
      await renderFeaturedProducts();
      await refreshCartUI();
    }

    async function renderFeaturedProducts(){
      productsGrid.innerHTML = `
        <div class="p-card" style="grid-column: span 12;">
          <div class="p-body">
            <h3 class="p-title">Loading products…</h3>
            <div class="tiny">Fetching from Shopify Storefront API</div>
          </div>
        </div>
      `;

      try{
        const collection = await client.collection.fetchByHandle(COLLECTION_HANDLE);
        const products = (collection && collection.products) ? collection.products.slice(0, 6) : [];

        if(!products.length){
          productsGrid.innerHTML = `
            <div class="p-card" style="grid-column: span 12;">
              <div class="p-body">
                <h3 class="p-title">No products found</h3>
                <div class="tiny">Check if your collection handle exists (default: "all").</div>
                <div class="p-actions">
                  <a class="btn primary" href="https://${SHOP_DOMAIN}/collections/all" target="_blank" rel="noopener">Open Full Store</a>
                </div>
              </div>
            </div>
          `;
          return;
        }

        productsGrid.innerHTML = products.map(p => {
          const img = (p.images && p.images.length) ? p.images[0].src : "";
          const title = p.title || "Product";
          const url = `https://${SHOP_DOMAIN}/products/${p.handle}`;
          const variant = (p.variants && p.variants.length) ? p.variants[0] : null;
          const price = variant ? (variant.price?.amount ?? variant.price) : "";
          const variantId = variant ? variant.id : "";

          return `
            <article class="p-card">
              ${img ? `<img class="p-img" src="${img}" alt="${title}">` : `<div style="height:240px;background:#fff"></div>`}
              <div class="p-body">
                <h3 class="p-title">${title}</h3>
                <div class="p-price">${price ? money(price) : ""}</div>

                <div class="p-actions">
                  <button class="btn primary" type="button" data-variant="${variantId}">Add to cart</button>
                  <a class="btn" href="${url}" target="_blank" rel="noopener">View</a>
                </div>

                <div class="tiny">Secure checkout via Shopify.</div>
              </div>
            </article>
          `;
        }).join("");

        // Bind add-to-cart buttons
        productsGrid.querySelectorAll("button[data-variant]").forEach(btn=>{
          btn.addEventListener("click", async ()=>{
            const vid = btn.getAttribute("data-variant");
            if(!vid) return;
            btn.textContent = "Adding…";
            btn.disabled = true;

            try{
              checkout = await client.checkout.addLineItems(checkout.id, [
                { variantId: vid, quantity: 1 }
              ]);
              await refreshCartUI();
              openDrawer();
            }catch(e){
              console.error(e);
              alert("Could not add to cart. Check Storefront token permissions.");
            }finally{
              btn.textContent = "Add to cart";
              btn.disabled = false;
            }
          });
        });

      }catch(err){
        console.error(err);
        productsGrid.innerHTML = `
          <div class="p-card" style="grid-column: span 12;">
            <div class="p-body">
              <h3 class="p-title">Could not load products</h3>
              <div class="tiny">Token invalid or Storefront API not enabled.</div>
              <div class="p-actions">
                <a class="btn primary" href="https://${SHOP_DOMAIN}/collections/all" target="_blank" rel="noopener">Open Full Store</a>
              </div>
            </div>
          </div>
        `;
      }
    }

    async function refreshCartUI(){
      if(!checkout) return;

      const items = checkout.lineItems || [];
      const count = items.reduce((acc,it)=> acc + (it.quantity || 0), 0);
      const total = checkout.totalPrice?.amount ?? checkout.totalPrice ?? "0";

      if(count > 0){
        cartCount.style.display = "grid";
        cartCount.textContent = String(count);
      }else{
        cartCount.style.display = "none";
      }

      cartTotal.textContent = money(total);

      cartItems.innerHTML = items.length ? items.map(it=>{
        const img = it.variant?.image?.src || "";
        const name = it.title || "Item";
        const variantTitle = it.variant?.title ? it.variant.title : "";
        const price = it.variant?.price?.amount ?? it.variant?.price ?? "";
        const qty = it.quantity || 1;
        return `
          <div class="item">
            ${img ? `<img src="${img}" alt="${name}">` : `<div style="width:66px;height:66px;border-radius:14px;background:#fff;border:1px solid rgba(15,23,42,.10)"></div>`}
            <div>
              <div class="name">${name}</div>
              <div class="meta">${variantTitle ? variantTitle + " • " : ""}${money(price)} • Qty: ${qty}</div>
            </div>
          </div>
        `;
      }).join("") : `<div class="tiny">Your cart is empty.</div>`;
    }

    function goCheckout(){
      if(!checkout || !checkout.webUrl){
        window.open(`https://${SHOP_DOMAIN}/collections/all`, "_blank", "noopener");
        return;
      }
      // Shopify secure checkout
      window.open(checkout.webUrl, "_blank", "noopener");
    }
    checkoutBtn.addEventListener("click", goCheckout);
    checkoutBtnTop.addEventListener("click", goCheckout);

    // Footer year
    document.getElementById("y").textContent = new Date().getFullYear();

    // Init
    initShopify();
  </script>
</body>
</html>
